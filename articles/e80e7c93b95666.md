---
title: "Rust vs. Go: Implementing Dependency Injection for Effective Unit Testing"
emoji: "🚀"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: []
published: false
---
Rust 初心者として、テストの実装方法について学ぶ。

テストを実装可能にするために、依存関係の逆転（DI）を取り入れる。DI は、どの開発言語でも実践するもの。

その前に、`main.rs` は entorypoint として、routes、model に分ける。

そして、Unit test code を追加する。

実践的なコードは書けるようになってきた一方で、LeetCode の Graph, BFS, DFS を見ていると、algorithm に特化した学習が必要かもしれない。

「Rust できます」と言えるまでにはもう少し時間がかかりそう。

## How to write tests
Rust におけるテストの書き方について。

Unit tests と Integration tests の 2つある。

### Unit tests
logic 内に書く。
test code であることを明示するために、annotation `cfg(test)` を付与する。

> Unit Tests
The purpose of unit tests is to test each unit of code in isolation from the rest of the code to quickly pinpoint where code is and isn’t working as expected. You’ll put unit tests in the src directory in each file with the code that they’re testing. The convention is to create a module named tests in each file to contain the test functions and to annotate the module with cfg(test).

https://doc.rust-lang.org/book/ch11-03-test-organization.html?highlight=cfg(test)#unit-tests

`cfg(test)` を付与するのが慣例ということ。

試しに unit tests を書く。

```rust:routes.rs
#[cfg(test)]
mod tests {
    use super::*;

    #[tokio::test]
    async fn test_api_response_users() {
        let user = User {
            user_id: 9999,
            email_address: Some("hoge@example.com".to_string()),
            created_at: Some(0),
            deleted: Some(0),
            settings: Some("option".to_string()),
        };
        let response = ApiResponse::UserResponse(Some(user)).into_response();
        assert_eq!(response.status(), StatusCode::OK);
    }
}
```

テストを実行する
```bash
vscode ➜ /workspaces/rust-api-samples/main (main) $ cargo test
    Finished test [unoptimized + debuginfo] target(s) in 2.66s
     Running unittests src/main.rs (target/debug/deps/main-794ccb24f64c7f92)

running 1 test
test routes::tests::test_api_response_users ... ok

test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

vscode ➜ /workspaces/rust-api-samples/main (main) $ 
```

また、Unit tests を VS Code の画面から実行できる。
![unit test](image.png)

## Rust Web Server
実装の手順
1. 

## Rust to Go Conversion
実装の手順
1. 
